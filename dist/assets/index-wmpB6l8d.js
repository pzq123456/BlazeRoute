(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function e(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(o){if(o.ep)return;o.ep=!0;const n=e(o);fetch(o.href,n)}})();const N=Math.PI/180;function L(i,t=1){let e=i.slice();if(e.length<3)return 0;let r=0,o=e.length;e.forEach((n,a)=>{e[a]=n.map(s=>s*N)});for(let n=0;n<o;n++){let a=(n+1)%o,s=(n+2)%o;r+=(e[n][0]-e[s][0])*Math.sin(e[a][1])}return r*=t*t/2,Math.abs(r)}function Y(i,t=1){let e=P.isLineString(i)?i.toXY():i;if(e.length<3)return 0;m.isPoint(e[0])&&(e=e,e.map((n,a)=>{e[a]=n.toXY()})),e=e;let r=0,o=e.length-1;for(let n=0;n<e.length;n++)r+=(e[o][0]+e[n][0])*(e[o][1]-e[n][1]),o=n;return r=r*t*t/2,Math.abs(r)}function $(i,t,e=1){let r=Math.PI/180,o=i[0]*r,n=t[0]*r,a=Math.sin((t[0]-i[0])*r/2),s=Math.sin((t[1]-i[1])*r/2),h=a*a+Math.cos(o)*Math.cos(n)*s*s,u=2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h));return e*u}function j(i,...t){for(let e=0,r=t.length;e<r;e++){const o=t[e];for(const n in o)i[n]=o[n]}return i}const M=6378137,y=20037508342789244e-9,V=85.05112877980659,b={project(i){let t=Math.PI/180,e=V,r=Math.max(Math.min(e,i[1]),-85.05112877980659),o=Math.sin(r*t),n=M*i[0]*t,a=M*Math.log((1+o)/(1-o))/2;return a>y&&(a=y),a<-20037508342789244e-9&&(a=-20037508342789244e-9),n>y&&(n=y),n<-20037508342789244e-9&&(n=-20037508342789244e-9),[n,a]},unproject(i){let t=180/Math.PI;return[i[0]*t/M,(2*Math.atan(Math.exp(i[1]/M))-Math.PI/2)*t]},bounds:[-20037508342789244e-9,-20037508342789244e-9,y,y],name:"EPSG:3857"};function J(i,t){return[Math.min(i[0],t[0]),Math.min(i[1],t[1]),Math.max(i[2],t[2]),Math.max(i[3],t[3])]}const v=b.project;b.unproject;function q(i,t,e=!1){if(e){let r=v(i),o=t[0],n=t[1],a=t[2],s=t[3];return[o,n]=v([o,n]),[a,s]=v([a,s]),r[0]<o||r[0]>a||r[1]<n||r[1]>s}else{let r=t[0],o=t[1],n=t[2],a=t[3];return i[0]<r||i[0]>n||i[1]<o||i[1]>a}}let W=class k{constructor(t,e){this.stasticsCache=[],this.MBR=t,this.data=e,this.shape=[e.length,e[0].length,e[0][0].length],[this.bands,this.rows,this.cols]=this.shape}getShape(){return[this.data.length,this.data[0].length,this.data[0][0].length]}getBand(t){return this.data[t]}get width(){return this.cols}get height(){return this.rows}get bandCount(){return this.bands}setMBR(t){this.MBR=t}getXYZValue(t,e=0){let r=t[0],o=t[1];return this.data[e][o][r]}set XYZValue(t){let e=t[0],r=t[1],o=t[2],n=t[3],a=this.data[o][r][e];if(this.data[o][r][e]=n,this.stasticsCache[o]){let s=this.stasticsCache[o].max,h=this.stasticsCache[o].min,u=this.stasticsCache[o].mean,l=this.data[o][r][e];l>s&&(s=l),l<h&&(h=l);let f=u*this.rows*this.cols;f=f-a+l,u=f/(this.rows*this.cols),this.stasticsCache[o]={max:s,min:h,mean:u}}}getSubGrid(t,e=[0]){let r=t[0],o=t[1],n=t[2],a=t[3],s=[];for(let h of e){let u=[];for(let l=r;l<=n;l++){let f=[];for(let d=o;d<=a;d++)f.push(this.data[h][l][d]);u.push(f)}s.push(u)}return s}fillInvalidValue(t){let e=this.data[t],r=0,o=0;for(let a=0;a<this.rows;a++)for(let s=0;s<this.cols;s++){let h=e[a][s];h!==0&&(r+=h,o++)}let n=r/o;for(let a=0;a<this.rows;a++)for(let s=0;s<this.cols;s++){let h=e[a][s];(h===0||h===-9999||h===999999)&&(e[a][s]=n)}}getSubGridObj(t,e=[0]){let r=t[0],o=t[1],n=t[2],a=t[3],s=[];for(let u of e){let l=[];for(let f=r;f<=n;f++){let d=[];for(let p=o;p<=a;p++)d.push(this.data[u][f][p]);l.push(d)}s.push(l)}return new k(t,s)}ConvertToGridMBR(t){let e=t[0],r=t[1],o=t[2],n=t[3],a=this.getGridCoord([e,r]),s=this.getGridCoord([o,n]);if(a===null||s===null)return null;{let h=a[0],u=a[1],l=s[0],f=s[1];return[h,u,l,f]}}getGridCoord(t){if(q(t,this.MBR))return null;{let e=t[0],r=t[1],o=this.MBR[0],n=this.MBR[1],a=this.MBR[2],s=this.MBR[3],h=Math.floor((r-n)/(s-n)*this.rows),u=Math.floor((e-o)/(a-o)*this.cols);return[h,u]}}getCoordByGridCoord(t){let e=t[0],r=t[1],o=this.MBR[0],n=this.MBR[1],a=this.MBR[2],s=this.MBR[3],h=(r+.5)/this.cols*(a-o)+o,u=(e+.5)/this.rows*(s-n)+n;return[h,u]}getBandStatistics(t){if(!this.stasticsCache[t]){let e=this.data[t],r=e[0][0],o=e[0][0],n=0;for(let s=0;s<this.rows;s++)for(let h=0;h<this.cols;h++){let u=e[s][h];u>r&&(r=u),u<o&&(o=u),n+=u}let a=n/(this.rows*this.cols);this.stasticsCache[t]={max:r,min:o,mean:a}}return this.stasticsCache[t]}binarization(t,e){let r=this.data[t],o=[];for(let n=0;n<this.rows;n++){let a=[];for(let s=0;s<this.cols;s++)r[n][s]<e?a.push(0):a.push(1);o.push(a)}return o}getCoutourCode(t,e){let r=this.binarization(t,e),o=[];for(let n=0;n<this.rows-1;n++){let a=[];for(let s=0;s<this.cols-1;s++){let h=0;h+=r[n][s]*8,h+=r[n][s+1]*4,h+=r[n+1][s+1]*2,h+=r[n+1][s]*1,a.push(h)}o.push(a)}return o}getMean(t){let e=this.data[t],r=0;for(let o=0;o<this.rows;o++)for(let n=0;n<this.cols;n++)r+=e[o][n];return r/(this.rows*this.cols)}getSorted1DArray(t){let e=this.data[t],r=[];for(let o=0;o<this.rows;o++)for(let n=0;n<this.cols;n++)r.push(e[o][n]);return r.sort((o,n)=>o-n),r}static fromFillValue(t=0,e){let r=[];for(let o=0;o<e[0];o++){let n=[];for(let a=0;a<e[1];a++){let s=[];for(let h=0;h<e[2];h++)s.push(t);n.push(s)}r.push(n)}return new k([0,0,0,0],r)}};class I{constructor(t,e){this.bbox=[1/0,1/0,-1/0,-1/0],this.projection=b,this.coordinates=t,e&&(this.properties=e),this.updateBBox()}toXY(){}set Properties(t){this.properties=t}clone(){const t=this.coordinates.slice(),e={...this.properties};return new this.constructor(t,e)}equals(t){return JSON.stringify(this.toGeoJSON())===JSON.stringify(t.toGeoJSON())}toGeoJSON(){let t={type:"Feature",geometry:{type:this.constructor.name,coordinates:this.coordinates}};return this.properties&&(t.properties=this.properties),this.bbox&&(t.bbox=this.bbox),t}static fromGeoJSON(t){if(t.type==="Feature")return this.fromFeature(t);if(t.type==="Geometry")return this.fromGeometry(t);throw t.type==="FeatureCollection"?new Error(t.type+"is not supported"):new Error("Unknown GeoJSON type: "+t.type)}}class H{constructor(t,e){this.geometries=[],this.bbox=[1/0,1/0,-1/0,-1/0],this.projection=b,e&&(this.properties=e),t.forEach(r=>{this.geometries.push(r),this.updateBBox(r)})}toXY(){}updateBBox(t){const e=t.bbox;e&&(this.bbox=J(this.bbox,e))}addGeometry(t){this.geometries.push(t),this.updateBBox(t)}_update(t,e){this.geometries[e]=t,this.updateBBox(t)}toGeoJSON(){let t={type:"Feature",geometry:{type:"GeometryCollection",geometries:this.geometries.map(e=>e.toGeoJSON().geometry)}};return this.properties&&(t.properties=this.properties),this.bbox&&(t.bbox=this.bbox),t}}class m extends I{get lon(){return this.coordinates[0]}get lat(){return this.coordinates[1]}constructor(t,e){super(t,e)}updateBBox(){this.bbox=[this.coordinates[0],this.coordinates[1],this.coordinates[0],this.coordinates[1]]}toXY(){return this.projection.project(this.coordinates)}static isPoint(t){return t instanceof m}static fromGeometry(t){return new m(t.coordinates)}static fromFeature(t){const{geometry:e,properties:r}=t;if(e.type!=="Point")throw new Error(`The input geometry is not a Point: ${e.type}`);const o=e;return r?new m(o.coordinates,r):new m(o.coordinates)}}class w extends H{constructor(t,e){t[0]instanceof m?(super(t,e),this.coordinates=t.map(r=>r.coordinates)):(super(t.map(r=>new m(r)),e),this.coordinates=t)}toXY(){return this.geometries.map(t=>t.toXY())}getCoodinates(){return this.coordinates}centroid(t){if(t){let e=0;for(let s=0;s<t.length;s++)e+=t[s];for(let s=0;s<t.length;s++)t[s]/=e;let r=0,o=0;for(let s=0;s<this.coordinates.length;s++){let h=this.coordinates[s];r+=h[0]*t[s],o+=h[1]*t[s]}let n=r,a=o;return new m([n,a])}else{let e=0,r=0;for(let a=0;a<this.coordinates.length;a++){let s=this.coordinates[a];e+=s[0],r+=s[1]}let o=e/this.coordinates.length,n=r/this.coordinates.length;return new m([o,n])}}addGeometry(t){t instanceof m?(this.geometries.push(t),this.coordinates.push(t.coordinates),this.updateBBox(t)):t instanceof w?(this.geometries.concat(t.geometries),this.coordinates.concat(t.coordinates),this.updateBBox(t)):(this.geometries.push(new m(t)),this.coordinates.push(t),this.updateBBox(this.geometries[this.geometries.length-1]))}toGeoJSON(){let t={type:"Feature",geometry:{type:"MultiPoint",coordinates:this.geometries.map(e=>e.coordinates)}};return this.properties&&(t.properties=this.properties),this.bbox&&(t.bbox=this.bbox),t}static isMultiPoint(t){return t instanceof w}static fromFeature(t){const{geometry:e,properties:r}=t;if(e.type!=="MultiPoint")throw new Error(`The input geometry is not a MultiPoint: ${e.type}`);const o=e;return r?new w(o.coordinates,r):new w(o.coordinates)}static fromGeometry(t){return new w(t.coordinates)}}class P extends I{constructor(t,e){super(t,e)}updateBBox(){let[t,e,r,o]=[1/0,1/0,-1/0,-1/0];for(const[n,a]of this.coordinates)t=Math.min(t,n),e=Math.min(e,a),r=Math.max(r,n),o=Math.max(o,a);this.bbox=[t,e,r,o]}toXY(){return this.coordinates.map(t=>this.projection.project(t))}toMultiPoint(){return new w(this.coordinates)}static fromGeometry(t){return new P(t.coordinates)}static fromFeature(t){const{geometry:e,properties:r}=t;if(e.type!=="LineString")throw new Error(`The input geometry is not a LineString: ${e.type}`);const o=e;return new P(o.coordinates,r)}static isLineString(t){return t.type==="LineString"}}const Z={R:6371e3,projection:null,distance(i,t){return $(i,t,this.R)},area(i){return L(i,this.R)}},z=85.05112877980659,K=j({},Z,{R:6378137,code:"EPSG:3857",projection:b,wrapLng:[-180,180],wrapLat:[-85.05112877980659,z],area(i){return L(i,this.R)},planeArea(i){return Y(i,this.R)}});j({},K,{code:"EPSG:900913"});class Q{constructor(){this.elements=[]}empty(){return this.elements.length===0}put(t,e){this.elements.push([e,t]),this.elements.sort((r,o)=>r[0]-o[0])}get(){var t;return(t=this.elements.shift())==null?void 0:t[1]}isEmpty(){return this.elements.length===0}}function U(i,t,e=!1){const r=i[0].length,o=i.length,n={grid:i,cols:r,rows:o,neighbors(a){const[s,h]=a;let u=[];return e?u=[[s-1,h-1],[s-1,h+1],[s+1,h-1],[s+1,h+1],[s+1,h],[s,h-1],[s-1,h],[s,h+1]]:u=[[s+1,h],[s-1,h],[s,h-1],[s,h+1]],(s+h)%2===0&&u.reverse(),u.filter(([l,f])=>l>=0&&l<r&&f>=0&&f<o)}};return n.weights=(a,s)=>t(i[a[1]][a[0]],i[s[1]][s[0]]),n}function R(i,t,e){let r=e,o=[];if(!i.has(e.join(",")))return[];for(;r&&r.join(",")!==t.join(",");)o.push(r),r=i.get(r.join(","));return o.push(t),o.reverse(),o}function _(i,t){const[e,r]=i,[o,n]=t;return Math.abs(e-o)+Math.abs(r-n)}function tt(i,t,e){const r=new Q;r.put(t,0);let o=new Map,n=new Map;for(o.set(t.join(","),null),n.set(t.join(","),0);!r.isEmpty();){const a=r.get();if(a.join(",")===e.join(","))break;for(const s of i.neighbors(a)){if(i.weights(a,s)===1/0)continue;const h=n.get(a.join(","))+i.weights(a,s);if(!n.has(s.join(","))||h<n.get(s.join(","))){n.set(s.join(","),h);const u=h+_(s,e);r.put(s,u),o.set(s.join(","),a)}}}return o}var E=(i=>(i[i.linear=0]="linear",i[i.square=1]="square",i[i.log=2]="log",i[i.power=3]="power",i[i.groupStretch=4]="groupStretch",i))(E||{});function O(i,t){return(i-t.min)/(t.max-t.min)}function et(i,t){return Math.sqrt((i-t.min)/(t.max-t.min))}function ot(i,t){return Math.log((i-t.min)/(t.max-t.min)+1)}function rt(i,t){return Math.pow((i-t.min)/(t.max-t.min),2)}function nt(i,t){let e=.1;return i<t.mean-e||i>t.mean+e?0:(i-t.min)/(t.max-t.min)}function it(i,t){switch(i){case 0:return O;case 1:return et;case 2:return ot;case 3:return rt;case 4:return nt;default:throw new Error("未知的拉伸类型")}}function F(i,t,e=O){let r=e(t,i),o=Math.floor(r*255);return`rgb(${o},${o},${o})`}function st(i,t){return(e,r)=>F(e,r,it(i))}function at(i,t,e,r,o){let n=e.w/t[0],a=e.h/t[1],s=i.getContext("2d");if(s===null)throw new Error("无法获取canvas绘图上下文");if(s.strokeStyle="red",s.lineWidth=1,r[0]&&r[1]){let[h,u]=ht(t,e,r);s.strokeRect(e.x+h*n,e.y+u*a,n,a),o&&o(h,u)}}function ht(i,t,e){let r=t.w/i[0],o=t.h/i[1],n=Math.floor((e[0]-t.x)/r),a=Math.floor((e[1]-t.y)/o);return[n,a]}function ut(i,t,e,r,o=F,n){let a=e.w/t[0].length,s=e.h/t.length,h=i.getContext("2d");if(h===null)throw new Error("无法获取canvas绘图上下文");for(let u=0;u<t.length;u++)for(let l=0;l<t[0].length;l++){let f=t[u][l],d=o(r,f);h.fillStyle=d,h.fillRect(e.x+l*a,e.y+u*s,a,s)}if(n){let[u,l,f,d]=n;h.strokeStyle="red",h.lineWidth=1,h.strokeRect(e.x+u*a,e.y+l*s,(f-u)*a,(d-l)*s)}h.restore()}function lt(i,t,e,r,o="gray",n){let a=e.w/t[0],s=e.h/t[1],h=i.getContext("2d");if(h===null)throw new Error("无法获取canvas绘图上下文");h.save();for(let u=0;u<t[0];u++)for(let l=0;l<t[1];l++){let f=r.get([l,u].join(","));if(f){let d=e.x+l*a+a/2,p=e.y+u*s+s/2,C=e.x+f[0]*a+a/2,S=e.y+f[1]*s+s/2;n&&n.find(([D,A])=>D===l&&A===u)?(T(h,d,p,C,S,"red"),f[0]===n[0][0]&&f[1]===n[0][1]&&(h.fillStyle="green",h.beginPath(),h.arc(C,S,10,0,2*Math.PI),h.fill()),f[0]===n[n.length-2][0]&&f[1]===n[n.length-2][1]&&(h.fillStyle="blue",h.beginPath(),h.arc(d,p,10,0,2*Math.PI),h.fill())):T(h,d,p,C,S,o)}else h.fillStyle=o,h.fillRect(e.x+l*a+a/2-2,e.y+u*s+s/2-2,4,4)}h.restore()}function T(i,t,e,r,o,n="green"){i.strokeStyle=n,i.lineWidth=2,i.beginPath(),i.moveTo(t,e),i.lineTo(r,o),i.stroke();let a=10,s=Math.atan2(o-e,r-t);i.beginPath(),i.moveTo(r,o),i.lineTo(r-a*Math.cos(s-Math.PI/6),o-a*Math.sin(s-Math.PI/6)),i.moveTo(r,o),i.lineTo(r-a*Math.cos(s+Math.PI/6),o-a*Math.sin(s+Math.PI/6)),i.stroke()}function ft(i,t,e,r="white"){let o=e.w/(t[0].length+1),n=e.h/(t.length+1),a=i.getContext("2d");if(a.save(),a===null)throw new Error("无法获取canvas绘图上下文");for(let s=0;s<t.length;s++)for(let h=0;h<t[0].length;h++){let u=t[s][h],l={x:e.x+h*o+o/2,y:e.y+s*n+n/2,w:o,h:n};dt(u,l,a,r)}a.restore()}function dt(i,t,e,r="white"){switch(e.strokeStyle=r,i){case 0:break;case 1:e.beginPath(),e.moveTo(t.x,t.y+t.h/2),e.lineTo(t.x+t.w/2,t.y+t.h),e.stroke();break;case 2:e.beginPath(),e.moveTo(t.x+t.w/2,t.y+t.h),e.lineTo(t.x+t.w,t.y+t.h/2),e.stroke();break;case 3:e.beginPath(),e.moveTo(t.x,t.y+t.h/2),e.lineTo(t.x+t.w,t.y+t.h/2),e.stroke();break;case 4:e.beginPath(),e.moveTo(t.x+t.w/2,t.y),e.lineTo(t.x+t.w,t.y+t.h/2),e.stroke();break;case 5:e.beginPath(),e.moveTo(t.x,t.y+t.h/2),e.lineTo(t.x+t.w/2,t.y),e.stroke(),e.beginPath(),e.moveTo(t.x+t.w/2,t.y+t.h),e.lineTo(t.x+t.w,t.y+t.h/2),e.stroke();break;case 6:e.beginPath(),e.moveTo(t.x+t.w/2,t.y),e.lineTo(t.x+t.w/2,t.y+t.h),e.stroke();break;case 7:e.beginPath(),e.moveTo(t.x,t.y+t.h/2),e.lineTo(t.x+t.w/2,t.y),e.stroke();break;case 8:e.beginPath(),e.moveTo(t.x,t.y+t.h/2),e.lineTo(t.x+t.w/2,t.y),e.stroke();break;case 9:e.beginPath(),e.moveTo(t.x+t.w/2,t.y),e.lineTo(t.x+t.w/2,t.y+t.h),e.stroke();break;case 10:e.beginPath(),e.moveTo(t.x+t.w/2,t.y),e.lineTo(t.x+t.w,t.y+t.h/2),e.stroke(),e.beginPath(),e.moveTo(t.x,t.y+t.h/2),e.lineTo(t.x+t.w/2,t.y+t.h),e.stroke();break;case 11:e.beginPath(),e.moveTo(t.x+t.w/2,t.y),e.lineTo(t.x+t.w,t.y+t.h/2),e.stroke();break;case 12:e.beginPath(),e.moveTo(t.x,t.y+t.h/2),e.lineTo(t.x+t.w,t.y+t.h/2),e.stroke();break;case 13:e.beginPath(),e.moveTo(t.x+t.w/2,t.y+t.h),e.lineTo(t.x+t.w,t.y+t.h/2),e.stroke();break;case 14:e.beginPath(),e.moveTo(t.x,t.y+t.h/2),e.lineTo(t.x+t.w/2,t.y+t.h),e.stroke();break}}b.unproject;const mt=document.getElementById("map"),G=1024,g=Mt(G,G);mt.appendChild(g);const pt=ut,wt=W,ct=ft,gt=at,yt=lt;let c=wt.fromFillValue(0,[1,16,16]),bt=st(E.power),x={x:0,y:0,w:1024,h:1024};function Mt(i,t){const e=document.createElement("canvas");return e.width=i,e.height=t,e}let B=[null,null];X();g.addEventListener("click",i=>{const t=g.getBoundingClientRect(),e=i.clientX-t.left,r=i.clientY-t.top;B=[e,r],gt(g,[16,16],x,B,xt),X()});function xt(i,t){c.getXYZValue([i,t])===1?c.XYZValue=[i,t,0,0]:c.XYZValue=[i,t,0,1]}function Pt(i,t){return i===1||t===1?1/0:1}function X(){const i=U(c.data[0],Pt);let t=tt(i,[0,0],[10,10]),e=R(t,[0,0],[10,10]);pt(g,c.data[0],x,c.getBandStatistics(0),bt),ct(g,c.getCoutourCode(0,1),x,"red"),yt(g,[16,16],x,t,"gray",e)}
